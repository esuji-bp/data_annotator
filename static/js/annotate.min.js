/*! yuyu-data 2018-09-08 */

var koma_id=document.getElementById("koma_id").value,next_rand_id=document.getElementById("next_rand_id").value,app=new Vue({el:"#annotate",delimiters:["[[","]]"],data:{chara_num:3,have_eyes_num:3,koma_id:"",whos_str:"",grad_str:"",eyes_str:"",step:1,grad_rad:0,grad_list:["左向き前","右向き前","正面前","背面"],chara_list:["ゆ","縁","唯","母","千","佳","ふ","他"]},mounted:function(){this.koma_id=koma_id,this.chara_num=document.getElementById("chara_num").value,this.whos_str=document.getElementById("whos").value,this.grad_str=document.getElementById("face_direction").value,this.eyes_str=document.getElementById("eyes").value,this.step=document.getElementById("step").value,this.eyes_str&&(this.have_eyes_num=this.eyes_str.split(",").length-1)},computed:{is_can_save:function(){if(0==this.chara_num){var e=""===this.whos_str&&""===this.grad_str,t=""===this.eyes_str&&0===this.have_eyes_num;return e&&t}{var s=""!==this.whos_str&&""!==this.grad_str;t=this.get_have_eyes_num()>0&&""!==this.eyes_str||0===this.get_have_eyes_num();const e=s&&t;var r=Number(this.chara_num)===this.whos_str.split(",").length-1,n=this.have_eyes_num===this.eyes_str.split(",").length-1;return e&&(r&&n)}},int_chara_num:function(){return Number(this.chara_num)},eyes_strc:function(){return this.eyes_str}},filters:{captionFormat:function(e){var t=this.koma_id.split("-");return`${t[0]}巻${t[1]}ページ${t[2]}コマ目`}},directives:{focus:{inserted:function(e){e.focus()}}},methods:{keymonitorCharaNum:function(e){"t"===e.key&&(window.location.href="/annotate/"+next_rand_id);var t=document.querySelectorAll(`[value='${e.key}']`);t[0]&&(t[0].checked=!0),this.chara_num=e.key,document.getElementById("rad0_whos").focus()},keymonitorWho:function(e){if("t"===e.key&&(window.location.href="/annotate/"+next_rand_id),"Escape"===e.key)this.whos_str="";else if("q"===e.key)document.getElementById("rad_grad0-1").focus();else{var t=this.chara_list[Number(e.key)-1],s=document.querySelectorAll(`[value='${t}']`);s[0]&&(s[0].checked=!0,this.whos_str=this.whos_str+t+",")}},keymonitorGrad:function(e){if("esc"===e.key)this.grad_str="";else if("e"===e.key){if(this.is_can_save){document.getElementById("annotate_form");document.querySelector("[type=submit]").click()}}else if("r"===e.key){if(this.is_can_save){document.getElementById("annotate_form");document.querySelector("[type=submit]").click()}}else{var t=this.grad_list[Number(e.key)-1];document.querySelectorAll(`[value='${t}']`);this.grad_rad=this.grad_rad%3+1;var s=`[value='${t}'][name=grad-${this.grad_rad}]`;document.querySelector(s).checked=!0,this.change_eyes_num()}},get_have_eyes_num:function(){for(var e=document.querySelectorAll("[type=radio]:checked"),t=0,s=0;s<e.length;s++){if(e[s].labels.length>0)e[s].labels[0].innerText.indexOf("前")>0&&t++}return t},send_chara_num:function(e){var t=e.target.labels[0].innerText;0===Number(t)&&this.reset_values(0)},send_who_str:function(e){var t=e.target.labels[0].innerText;t&&1==t.length&&(this.whos_str=this.whos_str+t+",")},send_grad_or_eyes_str:function(e){for(var t=document.querySelectorAll("[type=radio]:checked"),s="",r=0;r<t.length;r++){if(t[r].id.indexOf(e)>0)s=s+t[r].labels[0].innerText+","}"grad"==e?this.grad_str=s:"eyes"==e&&(this.eyes_str=s)},change_eyes_num:function(){this.have_eyes_num=this.get_have_eyes_num(),this.send_grad_or_eyes_str("grad"),this.$nextTick(function(){this.send_grad_or_eyes_str("eyes")})},reset_values:function(e=1){this.chara_num=1===e?1:0,this.have_eyes_num=0,this.koma_id="",this.whos_str="",this.grad_str="",this.eyes_str=""}}});